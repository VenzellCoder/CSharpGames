# "TANKS!" Upgrade
В проект от команды Unity "Tanks!" (https://assetstore.unity.com/packages/essentials/tutorial-projects/tanks-reference-project-80165) добавлены новые фичи:\
- разрушаемые деревья и здания в одиночном и мультиплеерном режимах\
- адаптивный уровень сложности в одиночной игре\
- новая механика нанесения урона наездом на противника

## Разрушаемые деревья и здания 
Было добавлено два новых класса, описывающих их поведение. 

```
public class Building : LevelHazard, IDamageObject

public class Tree : LevelHazard, IDamageObject
```
В начале раунда деревья и здания ввместе с минами сохраняются в списке в *GameManager*, и при рестарте уровня восстанавливают первоначальные свойства./
Теперь все разрушаемые объекты лежат на слое *13: DestructibleHazards*. В дальнейшем ключевое слово "Hazard" необходимо будет изменить на "DestructibleObstacles"/

В начале падения у деревьев выключаются *CapsuleCollider'ы* и на игровой процесс упавшие деревья влияния не оказываеют. Поэтому было принято решение не передавать лишние данные и позволить клиенту ронять деревья в случайном направлении. 

<img src="/\TanksNewFeatures(Unity)/pics/tanks_1.gif" alt="game pic"/>

## Адаптивный уровень сложности 
Игрок начинает одиночную компанию с уровнем 2. При каждом проигрыше уровень понижается, играть становится легче; при каждой победе - увеличиваться вместе со сложностью.\
Уровень сложности вияет на:\
- здоровье врагов\
- скорость врагов\
- скорость дружественных юнитов\
- скорострельность врагов\
- будут ли враги предсказывать местоположение игрока при стрельбе

Для хранения и лёгкого редактирования настроек был создан scriptabe object (классы *DifficultyLevelDetails* и *DifficultyLevelList*):

![difficultyeditor](https://user-images.githubusercontent.com/39743557/42085697-df8a19dc-7b99-11e8-8428-52714a0ec3db.PNG)

Реализация следующая:
Класс *DataStore* теперь хранит новую переменную *difficultyLevel*. Класс *PlayerDataManager* изменяет и сохраняет её методом

```
public void ChangeDifficyltyLevel(int levelChange)
```
При гибели танка или успешного окончания уровня в классе *SinglePlayerRulesProcessor* вызывается метод изменения уровня.

Класс *Nps* в методе *Awake()* проверяет текущий уровень сложности и сохраняет параметры для него в переменной для упрощения дальнейшего доступа.

```
void Awake()
		{
			int difficultyLevel = PlayerDataManager.s_Instance.difficultyLevel;
			npsDifficultyDetails = GameSettings.s_Instance.m_DifficultyLevelList.GetDifficultyLevelDetails (difficultyLevel);
		}
```

Объекты врагов кроме обязательного компонента *Nps* могут содержать компоненты *Navigator*, *Turret*, переменные в которы модифицируются в зависимости от уровня сложности и того, является ли объект дружественным *isFriendly*

## Урон при столкновении юнитов
За обработку столкновений и передачу данных серверу и клиентам отвечает синглтон класса *CrashManager*, как, например *ExplosionManager* отвечает за взрывы.\
В классе *TankMovement* через метод *OnCollisionEnter()* вызываются методы *CrashManager'а*.\
Урон при столкновении танк наносит при следующих условиях:\
- такн находится в движении\
- цель находится впереди танка (сектор в 90')\

![crash](https://user-images.githubusercontent.com/39743557/42085758-f88b40be-7b99-11e8-8806-bec2ab87329b.PNG)

Таким образом возможны интересные игровые ситуации:\
- танки врезаются лоб в лоб (оба получают урон)\
- один танк дагоняет другого сзади и таранит (сам урон не получает)\
- безопаснее всего таранить в бока\

В мультиплеерном режиме механика находится в разработке. На текущий момент, урон тараном наносит только host-игрок, урон остальных по непонятным причинам не сервер не передаётся.\   
В одиночном режиме игрок может таранить NPC, а NPC - игрока.

Чтобы было легче найти новый код в проекте, добавленные переменные и методы начинаются с комментария *// <VENZELL>*

